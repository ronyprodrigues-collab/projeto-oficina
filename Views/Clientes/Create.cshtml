@model Models.Cliente

@{
    ViewData["Title"] = "Cadastro de Cliente";
}

<h1>Cadastro de Cliente</h1>

<h4>Cliente</h4>
<hr />
<div class="row">
    <div class="col-lg-10 col-xl-8">
        <form asp-action="Create">
            <div asp-validation-summary="All" class="text-danger mb-2"></div>
            <partial name="_ClienteFormFields" model="Model" />
            <div class="form-group mt-3">
                <button type="submit" class="btn btn-success">Salvar</button>
                <a asp-action="Index" class="btn btn-secondary ms-2">Voltar</a>
            </div>
        </form>
    </div>
</div>


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        (function () {
            const tipoField = document.querySelector('[name="TipoCliente"]');
            const nomeLabel = document.getElementById('lblNome');
            const cpfGroup = document.getElementById('cpfGroup');
            const cnpjGroup = document.getElementById('cnpjGroup');
            const cpfInput = document.getElementById('CPF_CNPJ');
            const cnpjInput = document.getElementById('CNPJ');
            const cepInput = document.getElementById('CEP');

            function updateFields() {
                const tipo = tipoField?.value || 'PF';
                if (tipo === 'PJ') {
                    nomeLabel.textContent = 'Empresa';
                    cnpjGroup?.classList.remove('d-none');
                    cpfGroup?.classList.add('d-none');
                } else {
                    nomeLabel.textContent = 'Nome';
                    cnpjGroup?.classList.add('d-none');
                    cpfGroup?.classList.remove('d-none');
                }
            }

            function formatWithPattern(value, pattern) {
                const digits = (value || '').replace(/\D/g, '');
                let formatted = '';
                let digitIndex = 0;

                for (let i = 0; i < pattern.length; i++) {
                    const char = pattern[i];
                    if (char === '#') {
                        if (digitIndex < digits.length) {
                            formatted += digits[digitIndex++];
                        } else {
                            break;
                        }
                    } else {
                        if (digitIndex < digits.length) {
                            formatted += char;
                        } else {
                            break;
                        }
                    }
                }

                return formatted;
            }

            function attachMask(input, pattern) {
                if (!input) return;
                input.addEventListener('input', () => {
                    input.value = formatWithPattern(input.value, pattern);
                });
            }

            tipoField?.addEventListener('change', updateFields);
            updateFields();

            attachMask(cpfInput, '###.###.###-##');
            attachMask(cnpjInput, '##.###.###/####-##');
            attachMask(cepInput, '#####-###');
        })();
    </script>
}
